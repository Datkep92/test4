<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Quản lý hóa đơn</title>
<style>
  body{font-family:Arial,sans-serif;margin:0;padding:0;}
  #sidebar{width:200px;float:left;background:#f0f0f0;height:100vh;overflow:auto;padding:10px;}
  #main{margin-left:210px;padding:10px;}
  .log-box{border:1px solid #ccc;height:200px;overflow:auto;padding:5px;background:#fff;margin-top:10px;font-size:0.9em;}
  button{margin:5px 0;padding:8px 12px;font-size:0.9em;}
  .company-item{padding:5px;cursor:pointer;border-bottom:1px solid #ddd;}
  .company-item:hover{background:#e0e0ff;}
</style>
</head>
<body>

<div id="sidebar">
  <h3>Danh sách công ty</h3>
  <div id="companyList"></div>
  <hr>
  <input type="file" id="zipInput" multiple accept=".zip">
  <div id="statusMsg"></div>
</div>

<div id="main">
  <h3>Log xử lý</h3>
  <div class="log-box" id="logBox"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="handleZip.js"></script>
<script>
  const logBox = document.getElementById('logBox');
  function uiLog(msg){
    const p = document.createElement('div');
    p.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
    logBox.appendChild(p);
    logBox.scrollTop = logBox.scrollHeight;
  }

  window.logAction = uiLog; // ghi log từ JS gốc vào UI

  function renderCompanyList(){
    const listDiv = document.getElementById('companyList');
    listDiv.innerHTML='';
    for(const taxCode in hkdData){
      const div = document.createElement('div');
      div.textContent = `${hkdData[taxCode].name} (${taxCode})`;
      div.className='company-item';
      listDiv.appendChild(div);
    }
  }

  // === Tự động xử lý ZIP khi chọn file ===
  document.getElementById('zipInput').addEventListener('change', async (e)=>{
    const files = e.target.files;
    if(!files.length) return;
    document.getElementById('statusMsg').textContent = 'Đang xử lý...';
    await window.handleZipFiles(files);
    document.getElementById('statusMsg').textContent = `Đã nhập ${files.length} file.`;
    renderCompanyList();
  });
</script>
</body>
</html>